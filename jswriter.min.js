!function(t){t.fn.JSWriter=function(e){function r(t,e){var r=w.get(0).selectionStart,i=w.get(0).selectionEnd,o=w.val();w.val(o.substring(0,r)+t+o.substring(r,i)+e+o.substring(i))}function i(){p.html(e.textfilter(w.val()))}function o(){var t=n[0],e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen;e.call(t)}function a(e){var r,i=t('<style id="jswriter-styles"></styles'),o="";"object"!=typeof e&&(e=l());for(selector in e){o+=selector+"{",r=e[selector];for(prop in r)o+=prop+":"+r[prop]+";";o+="}"}i.text(o),t("head").append(i)}function l(){var t=40,e={".jswriter a":{cursor:"pointer"},".jswriter .editor":{border:"1px solid #aaa",height:"500px"},".jswriter .editor-window":{height:"100%",width:"100%","float":"left","overflow-y":"hidden"},".jswriter .editor-text":{padding:"15px"},".jswriter .editor-text:hover":{"overflow-y":"auto"},".jswriter .controls":{width:"100%",height:t+"px"},".jswriter .tabs":{"list-style":"none","padding-left":"0","margin-bottom":"0"},".jswriter .tabs li":{"float":"left",display:"block"},".jswriter .tabs a":{display:"block",height:t+"px","line-height":t+"px",padding:"0 5px","border-radius":"4px 4px 0px 0px",margin:"0 3px",color:"#888","background-color":"#eee","font-size":"1.5rem","text-decoration":"none"},".jswriter .tabs a:hover":{color:"#444","background-color":"#aaa"},".jswriter .tabs .active a":{"font-weight":"bold",color:"#111","background-color":"#aaa"},".jswriter .fullscreen":{"float":"right","text-decoration":"none",color:"#fff","background-color":"#5bc0de","border-radius":"4px",border:"1px solid #46b8da",padding:"0 5px",margin:"2px",height:t-4+"px","line-height":t-4+"px"},".jswriter .fullscreen:hover":{"background-color":"#46adcc"},".jswriter .tools":{"list-style":"none","padding-left":"0","margin-bottom":"0","background-color":"#eee"},".jswriter .tools:after":{content:'" "',display:"block",clear:"both"},".jswriter .tools li":{cursor:"pointer","float":"left","background-color":"#fff",border:"1px solid #666","text-align":"center","line-height":"20px",margin:"2px",width:"20px",height:"20px"},".jswriter .tools li:hover":{"background-color":"#eee"},".jswriter .tools .bold":{"font-weight":"bold"},".jswriter .tools .italic":{"font-style":"italic"},".jswriter textarea":{width:"100%",height:"474px"},".jswriter .editor.both .editor-window":{width:"49.5%"},".jswriter .text-write":{border:"0px",background:"#d8d8d8",resize:"none"},".jswriter .text-preview":{background:"#fff"},".jswriter .separator":{background:"#aaa","float":"left",width:"1%",height:"100%"},".jswriter .editor.preview .separator, .jswriter .editor.preview .text-write":{display:"none"},".jswriter .editor.write .separator, .jswriter .editor.write .text-preview":{display:"none"}};return e}var s={text:"",styles:!0,textfilter:function(t){return t}},e=t.extend(s,e);e.styles&&0==t("#jswriter-styles").length&&a(e.styles);var n=t(this),d=t('<div class="controls"><ul class="tabs"><li data-mode="both" class="active"><a>Both</a></li><li data-mode="write"><a>Write</a></li><li data-mode="preview"><a>Preview</a></li></ul><a class="fullscreen">Fullscreen</a></div>'),c=t('<div class="editor both"><div class="text-write editor-window"><ul class="tools"><li data-action="bold" class="bold">B</li><li data-action="italic" class="italic">I</li></ul><textarea name="text_markdown" class="text-write editor-text"></textarea></div><div class="separator"></div><div class="text-preview editor-text editor-window"></div></div>'),w=c.find(".text-write textarea"),p=c.find(".text-preview");n.addClass("jswriter"),n.append(d),n.append(c);var f="both";return d.on("click","li",function(){var e=t(this),r=e.data("mode");r!=f&&(c.removeClass(f),c.addClass(r),d.find(".active").removeClass("active"),e.addClass("active"),f=r)}),d.find(".fullscreen").click(o),w.on("keydown",function(t){if(9==(t.keyCode||t.which)){t.preventDefault();var e=w.get(0).selectionStart,r=w.get(0).selectionEnd;w.val(w.val().substring(0,e)+"	"+w.val().substring(r)),w.get(0).selectionStart=w.get(0).selectionEnd=e+1}}),w.on("keyup",i),c.find(".tools").on("click","li",function(){var e=t(this).data("action");"bold"==e?r("<strong>","</strong>"):"italic"==e&&r("<em>","</em>"),i()}),e.text.length>0&&(w.text(e.text),p.html(e.textfilter(e.text))),this.getTexts=function(){var t=w.val();return{write:t,preview:e.textfilter(t)}},this}}(jQuery);